<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin:0; padding:0; background-color:#f4f6f9; font-family:Arial,Helvetica,sans-serif;">
  <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#f4f6f9; padding:20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" style="background-color:#ffffff; border-radius:8px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.08);">
          <tr>
            <td style="background:linear-gradient(135deg,#ef4444,#dc2626); padding:25px 40px; text-align:center;">
              <h1 style="color:#ffffff; margin:0; font-size:22px;">Alerte Rupture de Stock</h1>
              <p style="color:#fecaca; margin:5px 0 0; font-size:14px;">{{ organization.name }}</p>
            </td>
          </tr>
          <tr>
            <td style="padding:25px 40px;">
              <p style="color:#374151; font-size:14px;">Bonjour {{ user.first_name|default:user.username }},</p>
              <p style="color:#6b7280; font-size:14px;">{{ total_critical }} produit(s) sont en risque de rupture de stock :</p>

              <table width="100%" cellpadding="8" cellspacing="0" style="font-size:13px; border:1px solid #e5e7eb; border-radius:6px; overflow:hidden; margin-top:15px;">
                <tr style="background-color:#fee2e2;">
                  <td style="font-weight:bold;">Produit</td>
                  <td align="center" style="font-weight:bold;">Stock</td>
                  <td align="center" style="font-weight:bold;">Jours restants</td>
                  <td style="font-weight:bold;">Urgence</td>
                </tr>
                {% for p in predictions %}
                <tr style="border-top:1px solid #f3f4f6;">
                  <td>{{ p.product_name }}</td>
                  <td align="center">{{ p.current_stock }}</td>
                  <td align="center" style="font-weight:bold; color:{% if p.urgency == 'critical' %}#dc2626{% else %}#f59e0b{% endif %};">
                    {{ p.days_remaining|default:"-" }}
                  </td>
                  <td>
                    <span style="display:inline-block; padding:2px 8px; border-radius:10px; font-size:11px; font-weight:bold; background-color:{% if p.urgency == 'critical' %}#fee2e2{% else %}#fef3c7{% endif %}; color:{% if p.urgency == 'critical' %}#991b1b{% else %}#92400e{% endif %};">
                      {% if p.urgency == 'critical' %}CRITIQUE{% else %}URGENT{% endif %}
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </table>

              <p style="color:#6b7280; font-size:13px; margin-top:15px;">Connectez-vous pour voir les recommandations de commande detaillees.</p>
            </td>
          </tr>
          <tr>
            <td style="padding:20px 40px; border-top:1px solid #e5e7eb; text-align:center;">
              <p style="color:#9ca3af; font-size:12px; margin:0;">Alerte automatique ProcureGenius</p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
