=================================================================
üöÄ GUIDE D'IMPL√âMENTATION √âTAPE PAR √âTAPE
=================================================================

PHASE 1: BACKEND (Priorit√© HAUTE)
=================================================================

√âTAPE 1: Modifier services.py
---------------------------------
Fichier: apps/ai_assistant/services.py

Action 1.1: Ajouter self.tools dans __init__
    Ligne ~25, apr√®s: self.model = getattr(settings, 'MISTRAL_MODEL', 'mistral-large-latest')
    Ajouter: self.tools = self._define_tools()

Action 1.2: Copier la m√©thode _define_tools() 
    Source: IMPLEMENTATION_GUIDE.md (lignes 30-280)
    Coller apr√®s: create_system_prompt()

Action 1.3: Remplacer la m√©thode chat()
    Source: IMPLEMENTATION_GUIDE.md (lignes 282-370)
    Remplacer: Toute la m√©thode async def chat()

Action 1.4: Mettre √† jour create_system_prompt()
    Source: IMPLEMENTATION_GUIDE.md (lignes 25-28)
    Remplacer le texte du prompt


√âTAPE 2: Compl√©ter ActionExecutor
---------------------------------
Fichier: apps/ai_assistant/services.py

Action 2.1: Mettre √† jour __init__ de ActionExecutor
    Ajouter 'add_invoice_items' et 'get_statistics' dans self.actions

Action 2.2: Mettre √† jour la m√©thode execute()
    Changer: action -> function_name
    Changer: params -> arguments

Action 2.3: Compl√©ter les m√©thodes manquantes
    - add_invoice_items() (IMPLEMENTATION_GUIDE.md ligne 420)
    - search_invoice() (ligne 450)
    - create_purchase_order() (ligne 480)
    - search_purchase_order() (ligne 520)
    - get_statistics() (ligne 540)


√âTAPE 3: Mettre √† jour views.py
---------------------------------
Fichier: apps/ai_assistant/views.py

Action 3.1: Mettre √† jour ChatView
    Source: BACKEND_ENDPOINTS.md (lignes 20-130)
    Remplacer toute la classe ChatView

Action 3.2: Ajouter QuickActionsView
    Source: BACKEND_ENDPOINTS.md (lignes 135-175)
    Ajouter apr√®s ChatView

Action 3.3: Ajouter ConversationListView
    Source: BACKEND_ENDPOINTS.md (lignes 180-220)

Action 3.4: Ajouter ConversationHistoryView
    Source: BACKEND_ENDPOINTS.md (lignes 225-280)

Action 3.5: Ajouter DocumentAnalysisView
    Source: OCR_IMPLEMENTATION.md (lignes 320-370)


√âTAPE 4: Mettre √† jour api_urls.py
---------------------------------
Fichier: apps/ai_assistant/api_urls.py

Ajouter ces routes:
    path('chat/', ChatView.as_view(), name='ai-chat'),
    path('quick-actions/', QuickActionsView.as_view(), name='quick-actions'),
    path('conversations/', ConversationListView.as_view(), name='conversation-list'),
    path('conversations/<str:conversation_id>/history/', ConversationHistoryView.as_view()),
    path('analyze-document/', DocumentAnalysisView.as_view(), name='analyze-document'),


√âTAPE 5: Modifier le mod√®le Message
---------------------------------
Fichier: apps/ai_assistant/models.py

Dans la classe Message, ajouter:
    tool_calls = models.JSONField(null=True, blank=True)
    metadata = models.JSONField(null=True, blank=True)


√âTAPE 6: Cr√©er et appliquer migrations
---------------------------------
Terminal:
    py manage.py makemigrations ai_assistant
    py manage.py migrate ai_assistant


√âTAPE 7: Tester le backend
---------------------------------
Terminal:
    py manage.py runserver

Autre terminal:
    curl -X POST http://localhost:8000/api/v1/ai/chat/ \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer YOUR_TOKEN" \
      -d '{"message": "Bonjour"}'


=================================================================
PHASE 2: FRONTEND (Priorit√© HAUTE)
=================================================================

√âTAPE 8: Cr√©er structure frontend
---------------------------------
Terminal:
    cd frontend/src/components
    mkdir AI
    cd AI


√âTAPE 9: Cr√©er les composants
---------------------------------
Cr√©er ces fichiers en copiant depuis FRONTEND_IMPLEMENTATION.md:

1. FloatingAIAssistant.jsx (lignes 20-300)
2. ChatMessage.jsx (lignes 310-380)
3. ThinkingAnimation.jsx (lignes 390-440)
4. QuickActionsPanel.jsx (lignes 450-480)
5. ActionResultCard.jsx (lignes 490-550)
6. DocumentUploader.jsx (lignes 560-600)


√âTAPE 10: Mettre √† jour api.js
---------------------------------
Fichier: frontend/src/services/api.js

Ajouter √† la fin:
    export const aiChatAPI = {
      sendMessage: (data) => axios.post('/api/v1/ai/chat/', data),
      getQuickActions: (category) => axios.get('/api/v1/ai/quick-actions/', { params: { category } }),
      analyzeDocument: (formData) => axios.post('/api/v1/ai/analyze-document/', formData, {
        headers: { 'Content-Type': 'multipart/form-data' }
      }),
    };


√âTAPE 11: Installer d√©pendances frontend
---------------------------------
Terminal:
    cd frontend
    npm install react-markdown


√âTAPE 12: Tester le frontend
---------------------------------
Terminal:
    cd frontend
    npm start

Navigateur:
    http://localhost:3000
    Cliquer sur bouton flottant IA
    Envoyer "Bonjour"


=================================================================
TESTS DE VALIDATION
=================================================================

Test 1: Chat basique
    Message: "Bonjour"
    Attendu: R√©ponse conversationnelle

Test 2: Function calling
    Message: "Cr√©e un fournisseur Test Corp"
    Attendu: Fournisseur cr√©√© + confirmation

Test 3: Recherche
    Message: "Trouve les fournisseurs actifs"
    Attendu: Liste des fournisseurs

Test 4: Statistiques
    Message: "Montre les stats du mois"
    Attendu: Statistiques affich√©es


=================================================================
FIN DU GUIDE
=================================================================
