{% extends 'pdf_base.html' %}
{% load i18n %}

{% block title %}Ordonnance - {{ patient.name }}{% endblock %}

{% block extra_css %}
<style>
    @page {
        size: A5 landscape;
        margin: 1.5cm;
    }

    .doc-title {
        text-align: center;
        font-size: 18pt;
        font-weight: bold;
        text-transform: uppercase;
        margin: 20px 0;
        letter-spacing: 2px;
        text-decoration: underline;
    }

    .patient-info {
        background-color: #f9fafb;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
    }

    .info-row {
        margin-bottom: 5px;
    }

    .label {
        font-weight: bold;
        margin-right: 10px;
        color: #666;
    }

    .prescription-body {
        margin-top: 20px;
        min-height: 250px;
    }

    .med-item {
        margin-bottom: 15px;
        border-bottom: 1px dashed #eee;
        padding-bottom: 10px;
    }

    .med-name {
        font-weight: bold;
        font-size: 12pt;
    }

    .med-dosage {
        padding-left: 20px;
        font-style: italic;
    }

    .signature-section {
        margin-top: 30px;
        text-align: right;
        page-break-inside: avoid;
    }

    .signature {
        display: inline-block;
        border-top: 1px dotted #000;
        width: 200px;
        text-align: center;
        padding-top: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="doc-title">Ordonnance Médicale</div>

<div class="patient-info">
    <div class="info-row">
        <span class="label">Patient:</span> {{ patient.name }} ({{ patient.get_age }} ans, {{ patient.gender }})
    </div>
    <div class="info-row">
        <span class="label">Poids/Taille:</span>
        {% if consultation.vital_signs.weight %}{{ consultation.vital_signs.weight }} kg{% else %}-{% endif %} /
        {% if consultation.vital_signs.height %}{{ consultation.vital_signs.height }} cm{% else %}-{% endif %}
    </div>
    <div class="info-row" style="text-align: right; font-size: 9pt; margin-top: -20px;">
        Date: {% now "d/m/Y" %}
    </div>
</div>

<div class="prescription-body">
    {% for item in items %}
    <div class="med-item">
        <div class="med-name">
            {{ forloop.counter }}. {{ item.medication_name }}
        </div>
        <div class="med-dosage">
            {{ item.dosage }}
            {% if item.frequency %} - {{ item.frequency }}{% endif %}
            {% if item.duration %} (Pendant {{ item.duration }}){% endif %}
        </div>
        {% if item.instructions %}
        <div style="padding-left: 20px; color: #666; font-size: 10pt;">
            Note: {{ item.instructions }}
        </div>
        {% endif %}
    </div>
    {% empty %}
    <div style="text-align: center; color: #999; margin-top: 50px;">
        Aucun médicament prescrit.
    </div>
    {% endfor %}
</div>

<div class="signature-section">
    <div>
        Fait à {{ organization.address|default:"Yaoundé" }}, le {% now "d/m/Y" %}
    </div>
    <br><br>
    <div class="signature">
        Dr. {{ consultation.doctor.get_full_name }}<br>
        <span style="font-size: 8pt;">Signature & Cachet</span>
    </div>
</div>
{% endblock %}