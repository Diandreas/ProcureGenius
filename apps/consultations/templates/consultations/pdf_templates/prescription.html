{% extends 'pdf_base.html' %}
{% load i18n %}

{% block title %}Ordonnance - {{ patient.name }}{% endblock %}

{% block extra_css %}
<style>
    .med-item {
        margin-bottom: 8px;
        border-bottom: 1px dashed #e5e7eb;
        padding-bottom: 6px;
    }

    .med-item:last-child {
        border-bottom: none;
    }

    .med-name {
        font-weight: 700;
        font-size: 10pt;
        color: #111827;
    }

    .med-dosage {
        font-style: italic;
        font-size: 9pt;
        color: #4b5563;
    }

    .med-instructions {
        padding-left: 10px;
        color: #4b5563;
        font-size: 9pt;
        margin-top: 2px;
        border-left: 2px solid {{ organization.brand_color|default:"#2563eb" }};
    }

    .signature-section {
        display: table;
        width: 100%;
        margin-top: 30px;
    }
</style>
{% endblock %}

{% block content %}
<div class="doc-title text-center">ORDONNANCE MÉDICALE</div>

<div class="info-grid">
    <div class="info-col" style="width: 50%;">
        <div class="info-label">Patient</div>
        <div class="info-value">
            <span class="text-bold" style="font-size: 10pt;">{{ patient.name }}</span><br>
            {{ patient.gender|default:"" }} | {% if patient.date_of_birth %}{{ patient.get_age }} ans{% else %}N/A{% endif %}
        </div>
        {% if prescription.valid_until %}
        <div class="info-label" style="margin-top: 6px;">Valide jusqu'au</div>
        <div class="info-value">{{ prescription.valid_until|date:"d/m/Y" }}</div>
        {% endif %}
    </div>
    <div class="info-col" style="width: 50%;">
        <div class="info-label">Détails Ordonnance</div>
        <div class="info-value">
            N°: {{ prescription.prescription_number }}<br>
            Date: {{ prescription.prescribed_date|date:"d/m/Y" }}
        </div>
    </div>
</div>

<div class="prescription-body">
    {% for item in items %}
    <div class="med-item">
        <div style="display: table; width: 100%;">
            <div style="display: table-cell; vertical-align: top;">
                <div class="med-name">
                    {{ forloop.counter }}. {{ item.medication_name }}
                </div>
            </div>
            <div style="display: table-cell; text-align: right; vertical-align: top;">
                <span class="med-dosage">
                    {{ item.dosage }}
                    {% if item.frequency %} - {{ item.frequency }}{% endif %}
                    {% if item.duration %} ({{ item.duration }}){% endif %}
                </span>
            </div>
        </div>
        {% if item.instructions %}
        <div class="med-instructions">
            {{ item.instructions }}
        </div>
        {% endif %}
    </div>
    {% empty %}
    <div style="text-align: center; color: #9ca3af; margin-top: 30px; font-style: italic;">
        Aucun médicament prescrit.
    </div>
    {% endfor %}
</div>

<div class="signature-section">
    <div style="display: table-cell; width: 50%;">
        <div class="info-label">Fait à:</div>
        <div class="info-value">
            {{ organization.address|default:"Yaoundé" }}, le {{ prescription.prescribed_date|date:"d/m/Y" }}
        </div>
    </div>
    <div style="display: table-cell; width: 50%; text-align: right;">
        <div class="info-label">Médecin Prescripteur:</div>
        <div class="info-value"
            style="margin-top: 30px; border-top: 1px dotted #9ca3af; display: inline-block; width: 180px; text-align: center;">
            Dr. {{ prescriber.get_full_name|default:prescriber.username }}<br>
            <span style="font-size: 8pt; font-weight: normal;">Signature & Cachet</span>
        </div>
    </div>
</div>
{% endblock %}